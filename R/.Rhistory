#Extract clusters with k-means
clusters<-kmeans(pca.outlier.free$x[,1:2], opt$k, iter.max = 10)
# Run the PCA, outllier removal, PCA again
source('PCA_bor_aor_plot.R')
#Extract clusters with k-means
clusters<-kmeans(pca.outlier.free$x[,1:2], opt$k, iter.max = 10)
p.out.clu<-ggbiplot(pca.outlier.free, var.axes = F, labels = lab, groups = as.factor(clusters$cluster))
cluster_result<-data.table(sample_id = 1:nrow(outlier.free), cluster_id = clusters$cluster)
fwrite(cluster_result,
file = file.path(opt$o, paste0(basename(dirname(opt$f)), '_clusters.tsv')),
col.names = F, row.names = F, quote = F, sep = '\t')
file.name.out<-paste0(basename(dirname(opt$f)),'_outlier_free_with_cluster', '.pdf')
ggsave(p.out.clu, filename = file.path(opt$o, file.name.out))
setwd('/home/anne/Documents/featurecloud/code/federated_dp_pca/R/')
# Run the PCA, outllier removal, PCA again
source('PCA_bor_aor_plot.R')
var60.pca<-which.perc(explained.variance(pca$sdev), 0.6)
#Remove outlier and rerun.
if(length(ou)!=0){
outlier.free<-data[-ou]
lab<-1:nrow(data)
lab<-lab[-ou]
}else{
outlier.free<-data
lab<-1:nrow(data)
}
var0<-which(apply(outlier.free,1, function(x) var(x)==0))
outlier.free<-outlier.free[, c(which(colSums(outlier.free)!=0), var0), with=F]
pca.outlier.free<-prcomp(outlier.free, scale. = T, center = T)
p.out<-ggbiplot(pca.outlier.free, var.axes = F, labels = lab)
#p.out
p.out<-ggbiplot(pca.outlier.free, var.axes = F, labels = lab)
file.name.out<-paste0(basename(dirname(opt$f)),'_outlier_free', '.pdf')
#Extract clusters with k-means
clusters<-kmeans(pca.outlier.free$x[,1:2], opt$k, iter.max = 10)
#Extract clusters with k-means
clusters<-kmeans(pca.outlier.free$x[,1:2], centers = opt$k, iter.max = 10)
opt$k = 5
#Extract clusters with k-means
clusters<-kmeans(pca.outlier.free$x[,1:2], centers = opt$k, iter.max = 10)
#Extract clusters with k-means
clusters<-kmeans(pca.outlier.free$x[,1:2], centers = opt$k, iter.max = 100)
#Extract clusters with k-means
clusters<-kmeans(pca.outlier.free$x[,1:2], centers = opt$k, iter.max = 1000)
#Extract clusters with k-means
clusters<-kmeans(pca.outlier.free$x[,1:2], centers = opt$k, iter = 1000)
#Extract clusters with k-means
clusters<-kmeans(pca.outlier.free$x[,1:2], centers = opt$k, iter = 10000)
